/*
 * Copyright (C) 2015 The greyfish authors
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

package org.asoem.greyfish.utils.math.statistics;

import org.junit.Test;

import static org.hamcrest.MatcherAssert.assertThat;
import static org.hamcrest.Matchers.closeTo;
import static org.hamcrest.Matchers.is;

public class StatisticalTestsTest {
    @Test
    public void testShapiroWilk() throws Exception {
        // given
        final double[] sample = new double[]{
                5.37845590999999956, -2.01084174000000004, 10.45616687999999961, 9.21116379999999957, 9.56897507999999952, 4.80365149999999996,
                5.20344019000000024, 8.25529084999999974, -1.02244124000000003, 3.87166517999999993, 7.38626393000000014, 9.57804849000000047,
                8.24364169000000047, 10.21995511999999984, 10.49685172000000044, -0.15460973000000000, 5.33749022000000028, 7.43450331000000020,
                0.89603617000000002, 2.19737060000000017, 3.77962533999999994, 3.62645844999999989, 3.27353431000000006, -0.20449025000000001,
                6.52207483000000021, 0.13981708000000001, 7.53065095000000007, 4.90363551999999991, 1.47412564999999995, 2.45085360999999979,
                1.51225009999999993, 4.06039453999999989, 8.30989678000000076, 4.32315872000000034, 2.16294655999999996, 1.01176617000000002,
                8.00412970000000001, 9.95400406000000082, 3.60413982999999982, 5.21622564000000022, 8.71800486000000063, 8.31175713000000016,
                0.08687077999999999, 8.63576637000000069, 6.19326650000000001, 9.83263218999999999, 3.34710696000000008, 2.02440379000000004,
                2.60508455999999988, 1.42579429999999996, 3.10715182999999984, 1.29887504999999992, 2.76649937000000001, 5.99314202999999956,
                5.65851530000000036, 5.99216870999999962, 7.61438633000000031, 5.47118949000000043, 4.61936291000000043, 1.75298916999999999,
                5.47493456000000034, 10.90773805000000074, 0.32725224000000003, 9.65111716999999913, 5.97095180999999986, 5.40608193000000004,
                6.24168871999999997, 7.95819721999999974, 5.25354528999999992, 7.21296558999999959, 5.07119681999999994, 0.18133726999999999,
                8.54981214999999928, 3.99207066999999993, 9.24370835999999940, 7.85521506999999986, 3.15611622999999986, 8.28831940999999972,
                7.41103143000000042, 2.01406763000000000, 8.39321209999999951, 10.42189300000000074, 8.22935767000000062, 4.27342200999999999
        };

        // when
        final ShapiroWilkTest shapiroWilkTest = StatisticalTests.shapiroWilk(sample);

        // then
        assertThat(shapiroWilkTest.statistics(), is(closeTo(0.9696, 1e-4))); // close to what R calculates
        assertThat(shapiroWilkTest.p(), is(closeTo(0.04435, 1e-4))); // close to what R calculates
    }

    @Test
    public void testShapiroWilk1000() throws Exception {
        // given
        final double[] sample = new double[]{
                3.3641129934, 8.3539744273, 4.6009665968, 0.2019080760, 6.8254246706, 8.1074257472,
                3.7929920597, 5.7020818416, 12.7723156452, 5.7199964325, 10.4300939167, 3.7865117023,
                9.3642190282, 6.1075257911, 9.2138989438, 7.6775631971, 8.8616271037, 5.1190761092,
                3.1109269383, 7.8371526823, -0.8462280457, 1.3924578158, 5.5150729018, 7.0473811373,
                0.7116364408, 3.7505535266, 5.6381572290, 6.5384695251, 6.2098957203, 5.0028912903,
                2.3013908129, 4.0031473542, 1.8930484403, 5.1561529047, 8.7250156344, 9.2937613888,
                7.1758501226, 3.7275808562, 9.4033798825, 6.8468817615, 4.8309518545, 1.3104422677,
                -0.1948963615, 6.5884116725, 7.6784544644, 3.2078533841, 2.4458015941, 3.1425341288,
                4.9753935461, 3.1385043400, 6.1800626575, 5.7083832341, 7.9563424708, 2.5962456138,
                5.6458986282, 6.6276097656, 3.8652978317, 5.8109792814, 0.8173010633, 0.7334583080,
                9.5694951612, 2.1641180369, 7.1833322783, 6.8452777322, 14.5387747794, 4.1121510676,
                3.6421846974, 5.4393940081, 5.6351767254, 4.0607028055, 5.4770978186, 5.1364861770,
                5.4175600516, 4.7446969224, 7.8962325972, 2.7220913820, 6.1078323376, 2.5110811405,
                3.0924475758, 4.5376182243, 6.9449403714, 6.1104236103, 0.4740784790, 11.1365580633,
                5.4636773834, 3.3398200638, 5.0819752112, 5.9057508258, 1.3133380033, 2.6331040515,
                11.1528612135, 1.3629095337, 3.3043918829, 5.6820986733, 1.9146685892, 3.1131294472,
                5.6140426109, 9.8722534954, 2.4328306022, 2.6975074663, 8.6598082790, 8.4623146147,
                2.8606254926, 4.7947544608, 0.1567781004, 3.3788562977, 2.3339655274, 5.2345987370,
                11.3730181596, 10.0608979019, 4.6974643420, 1.8420821987, 6.5214836847, 5.6585829585,
                7.2076649083, 3.7725599959, 4.0282317393, 9.5325773002, -1.4336936715, 5.1324108490,
                -0.0589075499, 4.8114019975, 2.0760426773, 5.6748071800, 5.7252847617, 5.2358065174,
                3.9323946562, 9.1794571468, 5.9417298899, 2.8256696281, -1.1844705931, -0.4757643525,
                6.3647800864, 3.1101984531, 1.9474750176, 2.9242812089, 3.4249841106, 6.7030328478,
                6.9634633376, 1.7136230896, 5.5855075984, 2.1930211560, 5.1572017081, 2.5111506297,
                7.9173330415, 5.9788271497, 5.4389417489, -0.5395268748, 7.4748457197, 8.0885671287,
                6.7352154516, 6.8005741443, 3.0754543462, 8.4219777924, 9.9947340588, 4.4312648769,
                3.9520963816, 0.8362375266, 3.4931414466, 1.7492934253, 7.4439265374, -0.7289236179,
                7.9531628024, 7.1517228543, 12.0295785864, 7.9181874632, 4.5987375202, 0.6343757539,
                5.4421386591, 4.6294627259, 11.2237990892, 1.8024141627, 3.2110968309, 6.2337003326,
                1.5939648665, 6.9173386393, 6.6540420561, 2.1833974719, 6.3495288195, 5.8595172138,
                8.1575949893, 3.9776501710, 3.3205485142, 6.4886896293, 8.8309807585, 8.0945563851,
                2.2759872530, 5.4421444439, 1.1621827465, 4.7750126301, 7.8684001778, 4.8438873485,
                9.0132706101, 9.3707885194, 4.4276658402, 8.2319270112, 4.0722818548, 7.9015905801,
                2.2699755953, 3.6252453938, 4.0228412017, 0.4020953981, 7.7404520716, 2.5192028863,
                4.2963215806, 1.3627295160, 5.1171131642, 2.0713161075, 8.4242773868, 3.1537048305,
                3.2088072696, 4.0099881453, 5.0119259821, 4.1433550264, -0.9022265149, 2.6446887588,
                0.5858107638, 8.2141256081, -1.6537317052, 1.9429951367, 6.8517783588, 3.6306660409,
                8.5937303184, 8.1901591451, 5.6888621036, 3.3098152982, 6.0528358182, 7.8297163740,
                7.6134518606, 9.6996515623, 8.4671337555, 4.5761690100, 13.5449542926, 3.5716127006,
                4.6951803658, 1.6427118754, 2.1079987137, 4.3435303877, 2.3459569048, 8.1306486424,
                5.2079147357, 2.3760311133, 1.9839137399, 5.5292638350, 7.7280353619, 1.5520929364,
                1.8397503512, 3.0471945791, 5.2945893916, 2.9586634478, 4.3983743366, 3.8423955912,
                5.9013561829, 7.0141041397, 5.6911961556, 6.1473352866, 5.3031857023, 6.9793966082,
                0.6723301779, 9.3158482203, -0.0866336469, 6.2815047773, 6.3844694685, 4.9179193087,
                7.9750900735, 2.6950465091, 10.6941587773, 5.4280564047, 6.5531033699, 4.8437010133,
                7.5210504774, 4.0762846184, 3.6206237054, 9.4696835659, 0.0517711643, 8.2695825956,
                3.0174045230, 5.8483007349, 6.7068690037, 0.6026347257, 2.5372718445, 4.5645320743,
                6.1138120374, 1.5401741493, 5.9031943533, 5.6949041064, 4.2512424985, 9.3695898295,
                5.1758770463, 0.7868096202, 9.2598128343, 4.5655631714, -1.9790273641, 0.8804098847,
                6.6792335267, 2.9877710547, 5.4153127663, 4.9788317915, 1.2924673529, 7.0624209951,
                5.5519967406, 6.5291833583, 5.3008757793, 11.5275561235, 8.1774243983, 9.9201775646,
                4.7078134242, 3.0619681495, 5.6806049992, 2.0554005393, 7.9872793330, 3.4496624492,
                3.8601959191, 7.5932515120, 6.1269901772, 7.6008406690, 4.3317563943, 2.6662590425,
                7.7746413780, 4.5134978464, 10.2258639446, 1.0037603518, 7.6966936518, 11.6139547086,
                4.1778822315, -1.3771375934, 7.9446319655, 4.7264808352, 4.9494220244, 0.3318164459,
                2.2053587637, -1.9516486096, 4.2297444411, 4.9530355378, 1.3669336601, 5.8885401120,
                7.3605745354, 4.1345377693, 6.3985314689, 8.1454005866, -0.1967038852, 7.2354266107,
                5.8806567134, 2.6707655971, 1.4316999779, 7.6130698018, 6.8339176690, 6.7231947390,
                4.6898382129, 2.5135154091, 5.3631617197, 8.8058613242, 3.7731336967, 7.3480918499,
                5.7841369653, -0.4983721152, 2.6639175166, 6.1342840174, 4.3661587196, 5.0295015392,
                4.0637463224, 1.2042223098, 5.9165987851, 6.1255200556, 2.8971554591, 7.5433382494,
                3.7227099290, 3.5234496689, 10.0116573997, 8.0278310104, 3.5845162545, 6.1113284497,
                3.9491492895, 4.9586332575, 10.2521910804, 10.3487053052, 9.3027755180, 6.7424994302,
                2.5876692127, 5.7356007243, 7.8632612139, 0.3735085819, 2.7938582754, 14.1543576871,
                6.2200751362, -0.9334089457, 9.7630633041, 9.4866486470, 5.7628548798, 1.6738280964,
                1.1419491832, 7.5988684662, 5.6936198074, 2.5747311504, -1.1183319837, 5.5258930992,
                1.8883087969, 7.7204599869, 8.4993050512, 4.2281490908, 2.1526701586, -1.3801597564,
                2.2205479006, 3.3450362790, 9.9953805193, 5.1418196536, 11.1699793961, 4.0060933770,
                -3.0404312995, 8.1439408651, 3.1234600446, 3.7140136102, 5.4853195558, 1.9997086723,
                4.5476689060, 6.0014130462, 5.4580248482, 3.4853200859, 5.7520408294, 8.8991572719,
                4.6205890203, 7.9258864576, 4.6979121198, 6.9975038986, 5.2143094660, 5.5976526036,
                3.6053064426, 6.2763284534, 9.1763716176, 2.5495106280, -6.2544904115, 4.0091701606,
                11.9129301051, 6.0971959105, 4.3241921976, 10.7649779954, 4.8543590353, 3.1146676153,
                2.9139906592, 6.3923370479, 2.3575179878, 5.6375228087, 7.0172184441, 5.6409776123,
                6.6488916967, 5.5967949699, 2.1730732157, 10.3486057964, 10.1672467003, 8.0526132826,
                6.3259597551, 2.4028896948, 0.8012442961, 2.5953548441, 5.5705574492, 4.3636442335,
                2.9228439070, 6.7243650299, 2.2387164895, 4.6478959991, 5.8136234478, 8.4906978108,
                -1.4531895811, 4.6294342863, 5.7082839464, 3.9690478855, 7.3374967281, 3.5262885413,
                5.0435006191, 3.9576299018, 5.1568480889, 4.6375059336, 8.8448896004, 3.6895248248,
                1.5249879653, 2.7875576259, 7.2005602709, 8.9259731469, 8.2068167775, 3.6241696623,
                6.5462909905, 2.4877416086, 4.8022731014, 7.4960847552, 4.3736092596, 2.9459052552,
                -1.1227958181, 2.4020656116, 3.3900488756, 1.6814247615, 4.6239255190, 7.0046298991,
                4.8134980782, 1.5809577744, 2.8493154063, 8.2162562724, 0.0248995369, 1.3304174031,
                6.0760496123, 5.8510204711, 4.4391337611, 4.7015168497, 2.6041726046, 4.0946561937,
                3.4579792068, 6.5684097584, 5.0465636270, -0.5582044893, 5.9485574042, 0.5513190117,
                8.2208862430, 4.8004689435, 0.9281361898, 0.8012632991, 6.6146313259, 3.9475074582,
                5.3655095007, 0.0007655356, 3.7599039792, 2.9464345325, 5.5109160743, 4.2755471762,
                2.7025086810, 12.0320349577, 4.4574449492, 8.4615105913, 7.8119157028, 8.6683741283,
                5.7698050734, 10.0854272763, 6.1416863772, 7.4492538095, 1.0703466946, 2.4612671961,
                -0.7153700817, 6.8906289103, 1.7333466541, 1.0136825439, 4.7602415347, 4.4859132831,
                0.4672211421, 9.3808365247, 6.2081356486, -0.2542494387, 4.8500267107, 8.5885281680,
                4.1527520299, 9.9223920683, 8.0377783105, 8.8540939113, 2.9205086436, 3.9147917986,
                7.3296821398, 4.4232939320, 10.6571248719, -0.3991916095, 2.0376926817, -3.3198635016,
                7.6905749897, 11.7550786241, 8.0945012470, -1.7093904670, 6.9388089843, 6.8713818994,
                5.3397415383, 1.6583960444, 6.9512914709, 2.9623306330, 2.7775462785, 4.3114648905,
                5.5335469436, 6.4799710238, 1.9382664904, 7.3732644431, 3.6703473341, 5.4750940650,
                5.0975311718, 5.4561040908, -0.4773576296, 11.4238654697, 9.3037651908, 8.2934506630,
                5.3804157460, 7.0842435654, 9.6554409204, 6.1829174109, 4.1782267332, 5.0971687611,
                2.1222206957, 3.9671374582, 8.7719352154, 0.8299148426, 5.1290122559, 5.3693543018,
                5.0003309731, 7.8941255998, 8.4720258101, 5.0829006140, 9.8474529151, 7.4958290923,
                9.4224154720, 4.9504730629, 8.4981303803, 6.2170112611, 4.7984691564, 7.9980563931,
                7.4591325475, 8.4314043849, 1.3657843389, 6.2661582627, 3.7750263370, 0.4194255083,
                0.9752870643, 2.9670587766, 1.7836386236, 3.7623588509, 11.5790553797, 3.6788304392,
                5.6627108035, 4.9770001331, 8.3007314828, 7.8554260059, 2.2362053519, 5.6212265628,
                -0.5923837759, 2.2215316407, 7.9245087500, 5.6472115937, -0.4312552315, 6.6699044124,
                2.7249615457, 2.1409335416, 4.0286440801, 6.7765722508, 8.8415317801, 2.2138329668,
                -0.3611371881, 6.3816952361, 12.1179391049, 4.1210365405, 3.6648517593, 9.4193864605,
                5.0729772891, 4.8291360522, 5.6803334521, 4.6844543777, 4.7340646186, 4.9055754354,
                6.9979369912, 8.0452962803, 4.2027022233, 8.8167899751, 8.7757317848, 7.1429566170,
                9.3509231029, 6.4206403209, 4.9562641112, -0.1446161567, 1.9449770325, 7.0679125611,
                3.7423418488, 10.2393488309, 2.7859264869, 5.5997752157, 4.1760696977, 3.8551443833,
                5.1522731269, 7.8771138230, 4.9584498234, 4.9978788981, 6.2175591959, 10.7284760409,
                3.0739973169, 9.5743386611, 3.0162359414, 2.0382298702, 10.3157978979, 9.2322357707,
                5.0481037731, 7.8384274742, 7.1540871123, 3.4692229097, 4.5272800691, 6.4614596917,
                2.1051695608, 4.2444347149, 3.9000942322, 4.7050178547, 0.5601073488, 10.5338748699,
                6.6771499586, 11.7900258601, 4.4843410624, 7.4443762001, 2.5492578180, 10.2951964223,
                1.2653413704, 7.5766239765, 5.2939757697, 0.5544940002, 7.3742133543, 4.5991253605,
                7.3766391749, 2.7816432930, 10.3226246725, 9.4136612572, 0.2665909185, 2.0220891663,
                -2.7131319255, 5.5306290118, 4.8821490499, 9.6888360851, 4.6998562741, 4.0251366581,
                2.8563202365, 12.9710634184, 6.3387424471, 11.3181687043, 1.6961348620, 3.5365993921,
                3.8118391538, 1.0012729728, 5.0581259412, 4.5898897753, 6.5950917400, 3.7693384648,
                -4.4354230288, 10.9889984678, 8.3563247527, 8.2583804580, 2.7582478812, 7.2778513722,
                6.7104028140, 1.4837894882, 8.7067576156, 8.0207944268, 6.2144489967, 4.3530006142,
                1.0536707227, 5.0795762133, 4.2590026848, 5.0709071685, 8.1962642365, 9.4583321549,
                -1.9062570556, 3.8238454428, 2.8381855071, 4.0790224366, 4.5721195602, 6.4990047544,
                3.4193799445, 4.0553637895, 4.1477673519, -1.0397395723, 1.5104706847, 0.6684797997,
                2.8230622569, 9.8494037657, 5.8040901016, 1.3855921979, 4.6839729813, 0.0464105245,
                11.2981425895, 2.6088687516, 6.3191610047, 3.3761625272, 10.6103529518, 4.3312926689,
                4.8298754555, -0.3198959032, 6.2211361376, 3.7521974779, 3.7879358004, 2.9974097379,
                9.1814589384, 3.5314073772, 5.2065255531, 8.0637185767, 7.4780650375, 8.5500086740,
                5.7517061762, 7.5187881358, 8.8321357093, 6.1311088433, 8.1686423267, 1.7036946679,
                8.8425443667, 8.0970544894, 6.9517306069, 4.4636330304, 4.7349423252, 6.1815200733,
                5.8472763404, 1.5453937358, 3.7439968922, 3.0225785703, 2.2276604832, 8.4412562033,
                5.3647250338, 4.1071697837, 9.1664484055, 5.2265163352, 2.7202959473, 5.3323103791,
                5.3856909579, 2.6480362475, -1.5548530777, 4.3196343230, 1.5208717335, 5.0126781454,
                2.0876123372, 4.3849278467, 8.1550219423, 5.7310549050, 6.9073043705, 3.2391012789,
                -1.4201893245, 7.6411973367, 6.1134474561, 9.9769318299, 5.1171796178, 10.2263422108,
                5.8474022341, 7.3094208972, 4.0666830434, 6.5712191652, 6.7652990697, 2.8728677545,
                2.6804095193, 3.8900460549, 3.8256303128, -2.6918572971, 5.0096147748, 9.2309053497,
                4.0782010499, 6.6634318061, 1.1189921821, 4.6320279915, 2.3932974052, 4.3635378038,
                5.6904754880, 4.5087880237, 2.6909929939, 9.6685970040, 5.5439280546, 3.4222619580,
                -0.4688354295, 3.9564851041, 2.5884413909, -0.0435842852, 4.7086661518, 10.3485176757,
                0.2668415115, 6.2605382004, 2.7921956268, -1.4663342313, 7.0249680869, 4.4931878765,
                7.4673364460, 4.0522307074, 3.5005962048, 1.7225720199, 4.9771999839, 8.0341789386,
                1.9523498309, 4.3458710970, 2.0601255560, 6.1366882418, 5.8033398068, 11.2523876465,
                9.4029224119, 8.6857654604, 1.0908759969, 4.2674125067, 3.3198178811, 9.1844814625,
                4.8993491602, 2.8159360929, 5.7940932557, 9.5560060297, 1.7109433366, 1.1017181800,
                6.2123547454, 7.5978647795, 2.8862227247, 9.5196167640, 2.3716812114, 7.9655141467,
                4.3916913302, 2.0678080339, 4.9926149245, 8.5712960351, 9.5105197470, 1.4760782454,
                8.6394996405, 2.4304531434, -0.0638939034, 6.1791870835, 6.5484647939, 1.3383118548,
                0.0107454978, 4.5700802278, 2.4802456928, 7.7743357618, 6.7181274459, -0.1031042875,
                4.0579654830, 8.3975656481, 7.9161240634, 1.2507507535, 7.4216047306, 2.9159617549,
                5.2862355106, 2.0700755642, -2.2941780263, 6.9755919713, 5.7523099887, 5.4319072355,
                5.2388035963, 7.3606231421, 3.1791675759, 6.8669609982, 1.1664970747, 5.1763257032,
                7.8005189840, 2.3107540585, 12.4381113208, 9.8245095726, 6.3030758508, 2.1167169184,
                3.5882269496, 1.7493306495, 5.7408477735, 4.3789486656, 2.6846646560, 2.5292514291,
                8.0423643567, 5.1453223579, 7.5788048039, 3.6266593217, 5.8428902948, 7.2694462201,
                7.2435528663, 6.2083722294, 7.6214574324, 5.9438038234, 4.7027881268, 2.9676125069,
                6.5693230461, 6.4259771119, 7.7173737624, 2.9294788882, 5.1041174825, 8.1329883973,
                7.7642183258, 5.7053272662, 3.0945447717, 3.7551642556, 7.8518131919, -0.5611287211,
                4.5033039023, 10.1307337393, 5.0852597088, 4.0879125707, 3.1834901512, 9.0518077496,
                1.7890107834, 11.3189967109, 5.6138755161, 12.3112740070, 3.6528532183, 5.9314360245,
                7.8723167980, 3.1738909856, 3.4547962526, 8.0500287119, 3.8809383610, 7.9421226263,
                0.7851525228, 3.3126556344, 4.5455739550, 5.7990462377, 3.7512687005, 5.5252137890,
                1.3706090037, 4.4058035584, 2.1845053793, 5.6772991078, 4.0286380633, 5.8270815677,
                4.1234656752, 2.2980048484, 8.4456590057, 3.3871719675, 8.8547187998, 7.3000169778,
                1.5997066752, 8.2424053156, 2.5095838329, 3.1853397115
        };

        // when
        final ShapiroWilkTest shapiroWilkTest = StatisticalTests.shapiroWilk(sample);

        // then
        assertThat(shapiroWilkTest.statistics(), is(closeTo(0.9991, 1e-4))); // close to what R calculates
        assertThat(shapiroWilkTest.p(), is(closeTo(0.9284, 1e-4))); // close to what R calculates
    }
}
